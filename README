使用说明:
1.使用前准备:使用前新建一个文件夹

1.1 自动建模+获取初始结构模块:
适用范围:
    电极体系NVT建模
    体相NPT建模
    狭缝孔NVT建模
模块流程介绍:
    1. 根据INPUT文件中的set_density参数,跑电极体系的NVT模拟,自动按比例调整指定分子的数量,直到体系密度达到设定值；对应 nsteps_den 
       另外,也可以不设置set_density参数,但是额外提供bulk建模所需要的top和inp文件,程序会自动进行体相NPT模拟,获取平衡密度作为set_density参数
       用两种方式建模的示例见 ./example/channel/set_density 和 ./example/channel/get_density_from_bulk (NaCl水溶液为例)

    2. 随后继续跑一段NVT模型确保体系平衡,对应 nsteps_equ

    3. 最后跑一小段NVT模拟,获取轨迹中最接近设定温度的时刻的结构,作为后续电极体系模拟的初始结构,对应 nsteps_ini 
        
    4. 最终输出 num_intialframes 个初始结构文件,命名为 frame1.gro, frame2.gro, ..., frameN.gro; 
       储存在 ./{Temperature}k 文件夹中, {Temperature}是你 mdp 中设置的热浴温度

    5. 关于体相:当指定建立体相模型时,程序自动进行体相NPT模拟后自动跳过步骤1,使用体相预平衡后的gro进行步骤2, 此时 set_density 参数无效
       体相建模示例见 ./example/bulk (NaCl水溶液为例)

    6. 关于狭缝孔:如果需要进行狭缝孔建模,则需要在INPUT文件中添加孔相关的参数。
       由于狭缝孔生成电极较为复杂,工作流集成了电极生成的脚本,首次使用时打开is_auto_top
       is_auto_top打开后会自动生成电极top和inp文件,你需要写好top和inp文件的头部(详细见示例)
       **************** 如果不是首次使用, 务必关掉 is_auto_top ***************
       电极的分子名分别为EL,ER,GRA, 但单侧电极只包含EL和GRA,所以初始的mdp只需冻结EL和GRA
       狭缝孔建模示例见 ./example/slit (NaCl水溶液为例)

所需文件:
    1.体相建模和电极建模需要的top文件,INPUT中的 `bulk_top` 和 `TOP`
        :  包括所有所需的itp文件
    2.能量最小化和模拟时所需的mdp文件,INPUT中的 `mini_MDP` 和 `MDP`
        :如果不指定set_density,请在`MDP`中写好压力耦合项并将其关闭
        :只进行体相建模时,`MDP`中仍建议保留一行加注释的 `ewald-geometry = 3dc` ,否则可能导致未知错误
        :使用slit模块,初始的mdp只冻结EL和GRA(见上述模块流程介绍)
    3.体相建模和电极建模需要的inp文件,INPUT中的`bulk_pa`和`packmol`
        **************** packmol中除电极外的pdb文件名要和top文件中的分子名称保持一致!!! ****************
    4.所有所需的pdb文件, slit建模不需要电极pdb
    5.INPUT文件

1.2 自动提交任务:
适用范围:
    适配所有使用CPM充电的任务 (扫描电压充电)
    其他的类型的任务也能提交,但会生成一些冗余文件或文件夹
    或者需要自己改写生成扫描电压的cpp文件 [./run_md/source/generate_scan.cpp]

模块流程介绍:
    自动复制模拟所需的初始文件到指定文件夹并提交任务

所需文件:
    初始结构文件夹 initialframes
        :里面放置初始结构gro文件和top文件
    matrixdata文件夹 matrixdata 
        :里面放置matrix数据文件
        :如果不进行CPM模拟,应当设置一个空文件夹,否则可能产生未知错误
    basicfile文件夹 basicfile 
        :里面放置力场、index和grompp文件
    INPUT文件

    示例见 ./example/run_md 

1.3 分析模块
适用范围:
    集成电极电荷计算, onfly输出的二进制文件的处理,系统产热的计算
    除上述三个部分外,可以在INPUT中diy自己的后处理(具体方式见 {分析模块中的MD_PP} )
    : 如需更改请前往 ./analysis/source/MD_PP.sh (line:24-31) 或 ./analysis/source/module_C++ 中相应的cpp文件
    特别注意需要每个case的命名为 case1, case2, ..., caseN 的格式

模块介绍:
    分析模块是个开放性的框架,使用者可以自行往 ./analysis/analysis.sh 添加自己的分析分支
    在analysis.sh添加自己的分支后,使用./md_flow.sh [analysis] [your_analysis_name] 来调用
    源代码位于 ./analysis/analysis.sh 
    当前分支包括
        : eleQ : 根据CPM_electrodeCharge.dat文件平均指定范围的case的电荷分布
        : onfly: 平均平均指定范围的case的onfly输出数据
        : mdpp:  使用<analyze_cpp>后处理并平均数据

    框架风格
        : 在analysis.sh仅调用下一层级的sh文件,在下一层级sh文件中调用具体cpp/python/matlab代码
        : 工作流提供了build_gmx_cpp.sh脚本编译需要链接gromacs库的后处理cpp,使用INPUT中的 `build_gmx` 参数指定编译环境

分析模块中的MD_PP:
    使用者需要使用INPUT中的 `analyze_cpp`指定cpp文件的文件名, 并将具体的cpp文件放置于 ./analysis/source/module_C++中
    MD_PP内置了-f -s -o 三个gmx后处理命令行参数,-f,-s,使用INPUT中的`deffnm`作为文件名(这意味着你在模拟时应使用-deffnm参数使输出文件名相同)
    :例如,若deffnm=slownvt,循环进行到case1时,执行的命令为
        <analyze_cpp> -f ./case1/slownvt.{xtcORtrr} -s ./case1/slownvt.tpr -o ./deal_data/<analyze_cpp>/1<analyze_cpp>.xvg {analysis_extra_command}
    :{xtcORtrr}和{analysis_extra_command}在INPUT中指定

md_pp中已经有的cpp:
    3维数密度(3DdensityZl_dynamic2020)
    偶极矩和z方向的夹角分布(angleOF_dipole_Z)
    计算电场3维分布(dynamic_force_bin2020)

所需文件:
    需要将INPUT放置在 case1 case2 ... caseN 文件夹的同级目录   
        : 如<适用范围>中所述,需要每个case的命名为 case1, case2, ..., caseN 的格式

使用实例:
    见 ./example/analysis

1.4 deal_data模块当作备份使用,唯一的JE模块也只能在eninstein机器上运行,忽略这一部分

2.使用方法:
    无需安装, 直接下载整个工作流文件夹即可使用
    chomd +x md_flow.sh # 赋予执行权限
    将md_flow.sh所在的路径写进PATH中,或者在使用时指定完整路径
    md_flow.sh -h/--help #查看详细使用说明
    md_flow.sh [module_name] [additional_arguments]
        module_name: frames / run / analysis
        additional_arguments: 根据不同模块的需要,填写相应的参数
            frames: []/[bulk]/[slit]
            run: []/[rerun]
            analysis: [eleQ]/[onfly]/[mdpp]/[your_analysis_name] (需要和analysis.sh中对应分支名称一致)

3. INPUT参数的简单介绍:
    ./INPUT使用指南

4.输出日志:
    在与INPUT同层级的 ./result 文件夹中

5.额外部分:
    自动提交任务和分析模块还可以支持 rerun:
        均需要在 ./case1 ./case2 ... 文件夹同级目录中执行命令
        执行命令时在命令行输入好的命令后额外加上 rerun 即可 (md_flow.sh run rerun / md_flow.sh analysis mdpp rerun)